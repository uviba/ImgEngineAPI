function newtimebox_OOS_uploader(){var e=this;this.isset=function(e){return"undefined"!=typeof e&&null!==e?!0:!1},this.upload_file=function(t,o,n,a){("undefined"==typeof a||a===!1)&&(a={});var i=o.find(".newtimebox-oos-image-uploader").attr("newtimebox-uploader-id");this.when_upload_begin_func(o,n,e.uploaded_item_count[i]);var r=new FormData;r.append("file",t),this.isset(a.addition_url_params)&&$.each(a.addition_url_params,function(e,t){r.append(e,t)}),r.append("response_url_params",e.response_url_params);var u=$.ajax({xhr:function(){var t=$.ajaxSettings.xhr();return console.log(t),t.upload&&t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var a=t.loaded/t.total;a=parseInt(100*a),e.when_upload_progress_func(t,a,o,n,e.uploaded_item_count[i])}},!1),t},url:NewTimeBox_UPLOAD_Url+"?connect_key="+NewTimeBox_API_CONNECT_KEY,type:"POST",data:r,processData:!1,contentType:!1,crossDomain:!0,success:function(t){var a=o.attr("upload-value"),r=o.find(".newtimebox-oos-image-uploader"),u=r.attr("upload-value");"undefined"!=typeof a&&a!==!1&&o.attr("upload-value",""),"undefined"!=typeof u&&u!==!1&&r.attr("upload-value","");try{var d=JSON.parse(t);d.error!==!0&&(void 0!==d.file_name||null!==d.file_name||d.file_name!==!1)&&e.uploaded_file_names[i].push(d.file_name)}catch(l){}e.when_upload_finish_func(t,o,n,e.uploaded_item_count[i])},error:function(){e.when_upload_fail_func(o,n,e.uploaded_item_count[i])}});e.xhr_req_ar.push(u)},this.xhr_req_ar=[],this.uploaded_file_names=[],this.upload_file_count_limit=[],this.uploaded_item_count=[],this.when_upload_finish_func=function(){},this.when_upload_fail_func=function(){},this.when_upload_begin_func=function(){},this.when_upload_progress_func=function(){},e.when_select_func=function(){},this.before_drag_word="Drag Photoes Here",this.after_drag_word="Drop Here",this.button_word="Choose Photoes",this.response_url_params="",this.select=function(e){return document.querySelectorAll(e)},this.when_upload_finish=function(t){e.when_upload_finish_func=t},this.when_upload_fail=function(t){e.when_upload_fail_func=t},this.when_upload_begin=function(t){e.when_upload_begin_func=t},this.when_upload_progress=function(t){e.when_upload_progress_func=t},this.when_select=function(t){e.when_select_func=t},this.set_response_url_params=function(t){e.response_url_params=t},this.getbyclass=function(e){return document.getElementsByClassName(e)},this.after=function(e,t){e.insertAdjacentHTML("afterend",t)},this.get_uploaded_file_names=function(t){return void 0!==t?e.uploaded_file_names[t]:e.uploaded_file_names},this.clear_uploaded_file_names=function(t){e.uploaded_file_names[t]=[]},this.create_input=function(){var t=$(".newtimebox-oos-image-uploader[manupulated-upload-button!=1]");$.each(t,function(){if(1!=$(this).attr("manupulated-upload-button")){var o=$(this).attr("newtimebox-uploader-id"),n=$(this).attr("multiple");console.log(n),"undefined"!=typeof n&&n!==!1?n===!1||"false"==n?e.upload_file_count_limit[o]=1:e.upload_file_count_limit[o]=!1:e.upload_file_count_limit[o]=1,$(this).hide(),$(this).attr("upload-value",""),$(this).attr("manupulated-upload-button",1);var a=t.attr("buttonStyle");("undefined"==typeof a||a===!1)&&(a="");var i=t.attr("buttonAttr");("undefined"==typeof i||i===!1)&&(i="");var r=t.attr("buttonClass");("undefined"==typeof r||r===!1)&&(r="");var u=t.attr("dragAreaStyle");("undefined"==typeof u||u===!1)&&(u="");var d=t.attr("dragAreaAttr");("undefined"==typeof d||d===!1)&&(d="");var l=t.attr("dragAreaClass");("undefined"==typeof l||l===!1)&&(l=""),$(this).after("<div "+i+' style="'+a+'" class=" '+r+' newtimebox-oos-image-uploader-button" >				'+e.button_word+"			</div>").after('<div style="'+u+'" '+d+'  class=" '+l+' newtimebox-oos-image-drop  " >'+e.before_drag_word+" </div>"),e.uploaded_file_names[o]=[],e.uploaded_item_count[o]=[]}});var o=t.parent().find(".newtimebox-oos-image-uploader-button"),n=t.parent().find(".newtimebox-oos-image-drop");o.on("click",function(){$(this).parent().find(".newtimebox-oos-image-uploader").click()}),n.on("drop dragdrop",function(){t.attr("upload-value",""),event.preventDefault();var o=$(this).parent().find(".newtimebox-oos-image-uploader").attr("newtimebox-uploader-id"),n=event.dataTransfer.files,a=0,i=e.upload_file_count_limit[o],r=$(this).parent(),u=n.length;i!==!1&&u>i&&(u=i),$.each(e.xhr_req_ar,function(e,t){t.abort()}),e.uploaded_file_names[o]=[],e.uploaded_item_count[o]=u,e.when_select_func(r,e.uploaded_item_count[o]),$.each(n,function(t,o){(i>a&&i!==!1||i===!1)&&(void 0!==o&&e.upload_file(o,r,a+1),a++)}),$(this).html(e.before_drag_word);var d=event.dataTransfer.getData("text/html");if(null==d||!e.isset(d)||""==$.trim(d)){var l=event.dataTransfer.getData("URL");return void(null!=l&&e.isset(l)&&""!=$.trim(l)&&e.upload_file(null,r,a+1,{addition_url_params:{imageUrl:l}}))}var s=$("<div>").append(d),p=$(s).find("img");if(0!==p.length)var _=p.attr("src");else{var f=$(s).find("a");if(0==f.length)return;var _=f.attr("href")}e.upload_file(null,r,a+1,{addition_url_params:{imageUrl:_}})}),n.on("dragenter",function(e){e.preventDefault()}),n.on("dragover",function(t){t.preventDefault(),$(this).html(e.after_drag_word)}),n.on("dragleave",function(t){t.preventDefault(),$(this).html(e.before_drag_word)}),t.on("change",function(){if(""==$(this).val())return!1;var o=0,n=$(this).parent().find(".newtimebox-oos-image-uploader").attr("newtimebox-uploader-id"),a=e.upload_file_count_limit[n],i=$(this).parent(),r=this.files.length;a!==!1&&r>a&&(r=a),$.each(e.xhr_req_ar,function(e,t){t.abort()}),e.uploaded_file_names[n]=[],t.attr("upload-value",""),t.find(".newtimebox-oos-image-uploader").attr("upload-value",""),e.uploaded_item_count[n]=r,e.when_select_func(i,e.uploaded_item_count[n]),$.each(this.files,function(t,n){(a>o&&a!==!1||a===!1)&&(e.upload_file(n,i,o+1),o++)}),$(this).val("")})}}var newtimebox_OOS_uploader=new newtimebox_OOS_uploader,newtimebox_uploader_callback=function(){$(function(){var e=$(".newtimebox-oos-image-drop"),t=$("html"),o=!1,n=-1;t.bind("dragenter",function(){e=$(".newtimebox-oos-image-drop"),$(".newtimebox-oos-image-uploader-button").hide(),e.show(),o=!0}),t.bind("drop",function(t){t.preventDefault(),o=!1,clearTimeout(n),n=setTimeout(function(){e=$(".newtimebox-oos-image-drop"),o||(e.hide(),$(".newtimebox-oos-image-uploader-button").show())},200)}),t.bind("dragover",function(){o=!0}),t.bind("dragleave",function(t){o=!1,clearTimeout(n),n=setTimeout(function(){o||(e.hide(),$(".newtimebox-oos-image-uploader-button").show())},200)}),newtimebox_OOS_uploader.create_input()}),$("head").prepend("<style>.newtimebox-oos-image-drop{display:none;border:2px dashed #4773dc;color:#5882ff;text-align:center;z-index:12;background:#f1f1f1;padding:14px;border-radius:2px;width:129px}.newtimebox-oos-image-uploader-button{text-align:center;padding:5px;border:1px solid #3086f5;background:#3086f5;color:#fff;width:123px;border-radius:4px;cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:10px 0}.newtimebox-oos-image-uploader-button:active{box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.newtimebox-oos-image-uploader-button:hover{background:#5198f3;border-color:#5198f3}</style>")};if(window.jQuery)newtimebox_uploader_callback();else{var script=document.createElement("script");script.type="text/javascript",script.src="https://code.jquery.com/jquery-1.9.1.min.js",script.onload=newtimebox_uploader_callback,document.getElementsByTagName("head")[0].appendChild(script)}