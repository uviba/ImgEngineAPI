function newtimebox_OOS_uploader(){var e=this;this.upload_image=function(o,t,n){this.when_upload_begin_func(t,n,e.uploaded_item_count);var a=new FormData;a.append("file",o),a.append("response_url_params",e.response_url_params);var i=$.ajax({xhr:function(){var o=$.ajaxSettings.xhr();return console.log(o),o.upload&&o.upload.addEventListener("progress",function(o){if(o.lengthComputable){var a=o.loaded/o.total;a=parseInt(100*a),e.when_upload_progress_func(o,a,t,n,e.uploaded_item_count)}},!1),o},url:NewTimeBox_UPLOAD_Url+"?connect_key="+NewTimeBox_API_CONNECT_KEY,type:"POST",data:a,processData:!1,contentType:!1,crossDomain:!0,success:function(o){var a=t.attr("upload-value"),i=t.find(".newtimebox-oos-image-uploader"),r=i.attr("upload-value");"undefined"!=typeof a&&a!==!1&&t.attr("upload-value",""),"undefined"!=typeof r&&r!==!1&&i.attr("upload-value","");try{var u=JSON.parse(o);u.error!==!0&&(void 0!==u.file_name||null!==u.file_name||u.file_name!==!1)&&e.uploaded_file_names.push(u.file_name)}catch(d){}e.when_upload_finish_func(o,t,n,e.uploaded_item_count)},error:function(){e.when_upload_fail_func(t,n,e.uploaded_item_count)}});e.xhr_req_ar.push(i)},this.xhr_req_ar=[],this.uploaded_file_names=[],this.upload_image_count_limit=!1,this.uploaded_item_count=1,this.when_upload_finish_func=function(){},this.when_upload_fail_func=function(){},this.when_upload_begin_func=function(){},this.when_upload_progress_func=function(){},e.when_select_func=function(){},this.before_drag_word="Drag Photoes Here",this.after_drag_word="Drop Here",this.button_word="Choose Photoes",this.response_url_params="",this.select=function(e){return document.querySelectorAll(e)},this.when_upload_finish=function(o){e.when_upload_finish_func=o},this.when_upload_fail=function(o){e.when_upload_fail_func=o},this.when_upload_begin=function(o){e.when_upload_begin_func=o},this.when_upload_progress=function(o){e.when_upload_progress_func=o},this.when_select=function(o){e.when_select_func=o},this.set_response_url_params=function(o){e.response_url_params=o},this.getbyclass=function(e){return document.getElementsByClassName(e)},this.after=function(e,o){e.insertAdjacentHTML("afterend",o)},this.get_uploaded_file_names=function(){return e.uploaded_file_names},this.create_input=function(){var o=$(".newtimebox-oos-image-uploader");o.attr("accept","image/*");var t=o.attr("multiple");console.log(t),"undefined"!=typeof t&&t!==!1?(t===!1||"false"==t)&&(this.upload_image_count_limit=1):this.upload_image_count_limit=1,$.each(o,function(){1!=o.attr("manupulated-upload-button")&&(o.attr("manupulated-upload-button",1),$(this).after('<div class="newtimebox-oos-image-uploader-button" >				'+e.button_word+"			</div>").after('<div class="newtimebox-oos-image-drop " >'+e.before_drag_word+" </div>"))}),o.hide();var n=o.parent().find(".newtimebox-oos-image-uploader-button"),a=o.parent().find(".newtimebox-oos-image-drop");n.on("click",function(){$(this).parent().find(".newtimebox-oos-image-uploader").click()}),a.on("drop dragdrop",function(){o.attr("upload-value",""),o.find(".newtimebox-oos-image-uploader").attr("upload-value",""),event.preventDefault();var t=event.dataTransfer.files,n=0,a=e.upload_image_count_limit;console.log(a);var i=$(this).parent(),r=t.length;a!==!1&&r>a&&(r=a),$.each(e.xhr_req_ar,function(e,o){o.abort()}),e.uploaded_file_names=[],e.uploaded_item_count=r,e.when_select_func(i,e.uploaded_item_count),$.each(t,function(o,t){(a>n&&a!==!1||a===!1)&&(void 0!==t&&e.upload_image(t,i,n+1),n++)}),$(this).html(e.before_drag_word)}),a.on("dragenter",function(e){e.preventDefault()}),a.on("dragover",function(o){o.preventDefault(),$(this).html(e.after_drag_word)}),a.on("dragleave",function(o){o.preventDefault(),$(this).html(e.before_drag_word)}),o.on("change",function(){if(""==$(this).val())return!1;var t=0,n=e.upload_image_count_limit,a=$(this).parent(),i=this.files.length;n!==!1&&i>n&&(i=n),$.each(e.xhr_req_ar,function(e,o){o.abort()}),e.uploaded_file_names=[],o.attr("upload-value",""),o.find(".newtimebox-oos-image-uploader").attr("upload-value",""),e.uploaded_item_count=i,e.when_select_func(a,e.uploaded_item_count),$.each(this.files,function(o,i){(n>t&&n!==!1||n===!1)&&(e.upload_image(i,a,t+1),t++)}),$(this).val("")})}}var newtimebox_OOS_uploader=new newtimebox_OOS_uploader,newtimebox_uploader_callback=function(){$(function(){var e=$(".newtimebox-oos-image-drop"),o=$("html"),t=!1,n=-1;o.bind("dragenter",function(){e=$(".newtimebox-oos-image-drop"),$(".newtimebox-oos-image-uploader-button").hide(),e.show(),t=!0}),o.bind("drop",function(o){o.preventDefault(),t=!1,clearTimeout(n),n=setTimeout(function(){e=$(".newtimebox-oos-image-drop"),t||(e.hide(),$(".newtimebox-oos-image-uploader-button").show())},200)}),o.bind("dragover",function(){t=!0}),o.bind("dragleave",function(o){t=!1,clearTimeout(n),n=setTimeout(function(){t||(e.hide(),$(".newtimebox-oos-image-uploader-button").show())},200)}),newtimebox_OOS_uploader.create_input()}),$("head").prepend("<style>.newtimebox-oos-image-drop{display:none;border:2px dashed #4773dc;color:#5882ff;text-align:center;z-index:12;background:#f1f1f1;padding:14px;border-radius:2px;width:129px}.newtimebox-oos-image-uploader-button{text-align:center;padding:5px;border:1px solid #3086f5;background:#3086f5;color:#fff;width:123px;border-radius:4px;cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:10px 0}.newtimebox-oos-image-uploader-button:active{box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.newtimebox-oos-image-uploader-button:hover{background:#5198f3;border-color:#5198f3}</style>")};if(window.jQuery)newtimebox_uploader_callback();else{var script=document.createElement("script");script.type="text/javascript",script.src="https://code.jquery.com/jquery-1.9.1.min.js",script.onload=newtimebox_uploader_callback,document.getElementsByTagName("head")[0].appendChild(script)}
